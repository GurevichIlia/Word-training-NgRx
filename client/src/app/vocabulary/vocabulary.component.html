<nb-card class="main-content" *ngIf="wordsFiltredByGroup$ | async as words; else loader">



  <nb-card-header>
    <div class="d-flex">
      <span class="search" *ngIf="words && words.length">
        <app-search [filterValue]="filterValue" (addWord)="getActionFromChildren($event)"></app-search>
      </span>
    </div>
  </nb-card-header>

  <nb-card-body >
          <ng-container *ngIf="wordGroups$ | async as groups; else loader">
      <app-groups [wordGroups]="wordGroups$ | async" [selectedGroup]="selectedGroup$ | async"
        (selectGroup)="selectedGroup$.next($event)">

        <nb-icon class="ml-1" [matMenuTriggerFor]="menu" icon="more-vertical-outline"></nb-icon>
        <mat-menu #menu="matMenu" class="matmenu">
          <div class="menuitem" (click)="openGroupModal('Add group')">
            <nb-icon icon="plus-outline"></nb-icon>
            <span class="ml-2" >Create group</span>
          </div>
          <div class="menuitem" *ngIf="selectedGroup$.getValue() !== '1' && selectedGroup$.getValue() !== '2'" (click)="showWordsForAssign()">
            <nb-icon icon="plus-circle-outline"></nb-icon>
            <span class="ml-2" >Add
              words</span>
          </div>
          <div class="menuitem" *ngIf="selectedGroup$.getValue() !== '1' && selectedGroup$.getValue() !== '2'" (click)="deleteWordGroup(selectedGroup$.getValue(), groups)">
            <nb-icon icon="trash-2-outline"></nb-icon>
            <span class="ml-2" >Delete
              group</span>
          </div>
        </mat-menu>

      </app-groups>

      <button (click)="openWordModal('Add word')" class="purpleButton mb-3 w-100" type="submit" nbButton
        size="small">Add
        word</button>

      <ng-container *ngIf="words.length; else empty">

        <app-word-list (action)="getActionFromChildren($event)" [pageSize]="pageSize" [trackWords]="trackWords"
          [filterValue]="filterValue.valueChanges" [menuItems]="wordMenuItems" [selectedGroup]="selectedGroup$ | async"
          [words]="words">
        </app-word-list>
      </ng-container>

      <ng-template #empty>
        <ng-container *ngIf="(selectedGroup$ | async ) as selectedGroup">
          <div class="text-center mt-2" *ngIf="selectedGroup !== '2'">
            <span class="first-word-title"> Add your first word</span>
          </div>

          <div class="text-center mt-2" *ngIf="selectedGroup === '1'">
            <span class="first-word-title">or take from <a routerLink="/general-words">Shared words <i
                  class="fas fa-users"></i></a></span>
          </div>


          <div class="text-center mt-2" *ngIf="selectedGroup === '2'">
            <span class="first-word-title">Click <img class="mb-3" style="width: 25px; height: 25px"
                src="../../assets/Photos/aa21eb60437133bf4f4be189636a187a-star-favorite-outline-icon-by-vexels.png"
                alt="">
              to add word to this group</span>
          </div>
        </ng-container>


      </ng-template>





    </ng-container>




    <!-- <ng-template #loader>
      <nb-card [nbSpinner]="true" nbSpinnerStatus="basic">
        <nb-card-body>
          Loading...
        </nb-card-body>
      </nb-card>
    </ng-template> -->


  </nb-card-body>

</nb-card>

<ng-template #loader>
  <nb-card [nbSpinner]="true" nbSpinnerStatus="basic">
    <nb-card-body>
      Loading...
    </nb-card-body>
  </nb-card>
</ng-template>

<ng-template #wordModal let-data let-ref="dialogRef">
  <nb-card class="wordDialogBox">
    <nb-card-header class="modal-header">
      <h4>{{titleForModal}}</h4>
    </nb-card-header>
    <nb-card-body>
      <form [formGroup]="newWordForm" class="row justify-content-center">
        <input formControlName="word" class="mb-1 col-12" type="text" fieldSize="small" nbInput placeholder="Word">
        <input formControlName="translation" class="mb-2 col-12" type="text" fieldSize="small" nbInput
          placeholder="Translate">
      </form>
    </nb-card-body>
    <nb-card-footer class="wordDialogFooter">
      <button nbButton status="danger" (click)="closeWordModal()">Cancel</button>
      <button class="purpleButton" *ngIf="titleForModal === 'Add word'" nbButton (click)="addNewWord()">Submit</button>
      <button class="purpleButton" *ngIf="titleForModal === 'Edit word'" nbButton
        (click)="updateWord(editWordOldValue, newWordForm.value)">Update</button>
    </nb-card-footer>
  </nb-card>
</ng-template>

<ng-template #groupModalRef let-data let-ref="dialogRef">
  <nb-card class="groups-modal">
    <nb-card-header>
      <h4>{{titleForModal}}</h4>
    </nb-card-header>
    <nb-card-body>
      <input [formControl]="groupName" class="mb-1 col-12" type="text" fieldSize="small" nbInput placeholder="Word">
    </nb-card-body>
    <nb-card-footer class="wordDialogFooter">
      <button nbButton status="danger" (click)="groupModal.close()">Cancel</button>
      <button *ngIf="titleForModal === 'Add group'" nbButton (click)="createNewGroup()">Submit</button>
      <button *ngIf="titleForModal === 'Edit group'" nbButton s>Update</button>
    </nb-card-footer>
  </nb-card>
</ng-template>
